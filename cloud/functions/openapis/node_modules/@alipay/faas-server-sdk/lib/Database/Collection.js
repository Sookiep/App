"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Collection=void 0;const faas_db_builder_1=require("@alipay/faas-db-builder"),faas_server_utils_1=require("@alipay/faas-server-utils"),errors_1=require("../errors"),middlewares_1=require("../requester/middlewares"),Aggregate_1=require("./Aggregate"),Document_1=require("./Document"),Query_1=require("./Query");class Collection{#e;#t;#r;constructor(e,t){this.#t=t,this.#r=new faas_db_builder_1.CollectionBuilder(t),this.#e=e}async add(e){const{options:t}=this.#r.add(e),s="POST",i=this.#s(e.data._id),n=(0,faas_server_utils_1.getAlipayContext)();t._openid=t._openid||n.OPENID;const r=await middlewares_1.HttpRequester.database.request(s,i,t,{},{cloudConfig:this.#e});if(!r.succeed)throw errors_1.errors.CALL_DATABASE_ERR(r);return r.data}doc(e){return new Document_1.Document(this.#t,e,this.#e)}limit(e){return new Query_1.Query(this.#t,this.#e).limit(e)}skip(e){return new Query_1.Query(this.#t,this.#e).skip(e)}where(e){return new Query_1.Query(this.#t,this.#e).where(e)}projection(e){return new Query_1.Query(this.#t,this.#e).projection(e)}orderBy(e,t){return new Query_1.Query(this.#t,this.#e).orderBy(e,t)}aggregate(){return new Aggregate_1.Aggregate(this.#t,this.#e)}async get(){return await new Query_1.Query(this.#t,this.#e).get()}async count(){return await new Query_1.Query(this.#t,this.#e).count()}#s(e){return e||(e=""),`${this.#e.functionDatabaseEndpoint}/${this.#e.functionDatabaseName||"faas"}/${this.#t}?_id=${e}`}}exports.Collection=Collection;