"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Query=void 0;const faas_db_builder_1=require("@alipay/faas-db-builder"),errors_1=require("../errors"),middlewares_1=require("../requester/middlewares");class Query{#e;#r;#t;constructor(t,s){this.#r=t,this.#e=s,this.#t=new faas_db_builder_1.QueryBuilder(t)}limit(t){return this.#t.limit(t),this}skip(t){return this.#t.skip(t),this}where(t){return this.#t.where(t),this}projection(t){return this.#t.projection(t),this}orderBy(t,s){return this.#t.orderBy(t,s),this}async update(t){const s="POST",r=`${this.#s()}?update`,{options:e}=this.#t.update(t),o=await middlewares_1.HttpRequester.database.request(s,r,e,{},{cloudConfig:this.#e});if(!o.succeed)throw errors_1.errors.CALL_DATABASE_ERR(o);return o.data}async set(t){const s="POST",r=`${this.#s()}?replace`,{options:e}=this.#t.set(t),o=await middlewares_1.HttpRequester.database.request(s,r,e,{},{cloudConfig:this.#e});if(!o.succeed)throw errors_1.errors.CALL_DATABASE_ERR(o);return o.data}async remove(){const t="POST",s=`${this.#s()}?delete`,{options:r}=this.#t.remove(),e=await middlewares_1.HttpRequester.database.request(t,s,r,{},{cloudConfig:this.#e});if(!e.succeed)throw errors_1.errors.CALL_DATABASE_ERR(e);return e.data}async get(){const t="POST",s=`${this.#s()}?query`,{options:r}=this.#t.get(),e=await middlewares_1.HttpRequester.database.request(t,s,r,{},{cloudConfig:this.#e});if(!e.succeed)throw errors_1.errors.CALL_DATABASE_ERR(e);return e.data}async count(){const t="POST",s=`${this.#s()}?count`,{options:r}=this.#t.count(),e=await middlewares_1.HttpRequester.database.request(t,s,r,{},{cloudConfig:this.#e});if(!e.succeed)throw errors_1.errors.CALL_DATABASE_ERR(e);return{total:e.data.count}}#s(){return`${this.#e.functionDatabaseEndpoint}/${this.#e.functionDatabaseName||"faas"}/${this.#r}`}}exports.Query=Query;