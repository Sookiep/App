"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AggregateBuilder=void 0;const AggregateRequest_1=require("../command/AggregateRequest"),QueryRequest_1=require("../command/QueryRequest"),constant_1=require("../common/constant"),error_1=require("../common/error"),util_1=require("../common/util");class AggregateBuilder{#r;#e;constructor(e){this.#r=e,this.#e=[]}match(e){return this.#t(constant_1.PipelineStageName.match,e),this}group(e){return this.#t(constant_1.PipelineStageName.group,e),this}sample(e){return this.#t(constant_1.PipelineStageName.sample,e),this}end(){const r={$aggregate:this.#e.map(t=>{switch(t.name){case constant_1.PipelineStageName.match:return{$match:new QueryRequest_1.QueryRequest(t.param).toJSON()};case constant_1.PipelineStageName.sample:return{$sample:t.param};case constant_1.PipelineStageName.group:return{$group:new AggregateRequest_1.AggregateRequest(t.param).toJSON()};default:{const a=t.name;throw error_1.DbBuildError.invalidParam(a,"\u4E0D\u652F\u6301\u7684 aggregate \u64CD\u4F5C")}}})};return util_1.ActionBuilder.buildDocumentAction(constant_1.DocumentAction.aggregate,this.#r,r)}#t(e,r){this.#e.push({name:e,param:r})}}exports.AggregateBuilder=AggregateBuilder;