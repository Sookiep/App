"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.QueryBuilder=void 0;const QueryRequest_1=require("../command/QueryRequest"),UpdateRequest_1=require("../command/UpdateRequest"),constant_1=require("../common/constant"),util_1=require("../common/util");class QueryBuilder{#s;#r;#u;#i;#n;#o;constructor(t){this.#o=t,this.#i=[]}limit(t){return this.#r=t,this}skip(t){return this.#u=t,this}where(t){return this.#s=t,this}projection(t){for(const e in t)t[e]?typeof t[e]!="object"&&(t[e]=1):t[e]=0;return this.#n=t,this}orderBy(t,e){return this.#i.push({field:t,sort:e}),this}update(t){return this.#e(constant_1.DocumentAction.update,{...this.#t(),$update:new UpdateRequest_1.UpdateRequest(t.data).toJSON()})}set(t){return this.#e(constant_1.DocumentAction.replace,{...this.#t(),$replace:t.data})}remove(){return this.#e(constant_1.DocumentAction.delete,this.#t())}get(){return this.#e(constant_1.DocumentAction.queryList,{$limit:100,...this.#c()})}count(){return this.#e(constant_1.DocumentAction.count,this.#t())}#t(){const t={};if(typeof this.#s<"u"){const e=new QueryRequest_1.QueryRequest(this.#s);t.$match=e.toJSON()}return typeof this.#r<"u"&&(t.$limit=this.#r),t}#c(){const t=this.#t();if(typeof this.#n<"u"&&(t.$project=this.#n),typeof this.#i<"u"){t.$sort={};for(const e of this.#i)t.$sort[e.field]=e.sort===constant_1.Sort.DESC?-1:1}return typeof this.#u<"u"&&(t.$skip=this.#u),t}#e(t,e){return util_1.ActionBuilder.buildDocumentAction(t,this.#o,e)}}exports.QueryBuilder=QueryBuilder;